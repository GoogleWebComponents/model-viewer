<!--
/* @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>&lt;model-viewer&gt; Examples and Documentation</title>
  <meta charset="utf-8">
  <meta name="description" content="&lt;model-viewer&gt; examples and documentation">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link type="text/css" href="../styles/examples.css" rel="stylesheet" />
  <link rel="shortcut icon" type="image/png" href="../assets/favicon.png" />
  <script src="../node_modules/resize-observer-polyfill/dist/ResizeObserver.js"></script>

  <!-- The following libraries and polyfills are recommended to maximize browser support -->

  <!-- 🚨 REQUIRED: Web Components polyfill to support Edge and Firefox < 63 -->
  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>

  <!-- 💁 OPTIONAL: Intersection Observer polyfill for better performance in Safari and IE11 -->
  <script src="../node_modules/intersection-observer/intersection-observer.js"></script>

  <!-- 💁 OPTIONAL: Resize Observer polyfill improves resize behavior in non-Chrome browsers -->
  <script src="../node_modules/resize-observer-polyfill/dist/ResizeObserver.js"></script>

  <!-- 💁 OPTIONAL: The :focus-visible polyfill removes the focus ring for some input types -->
  <script src="../node_modules/focus-visible/dist/focus-visible.js" defer></script>

  <style>
    html {
      scroll-behavior: smooth;
      scroll-padding-top: 75px;
      ;
    }

    .sidebar {
      margin: 0;
      padding: 0;
      width: 300px;
      background-color: #f6f6f6;
      position: fixed;
      height: 100%;
      overflow: auto;
      border: 1px solid #BDBDBD;
    }

    .outer-content {
      margin-left: 300px;
    }

    .inner-content {
      padding: 10px 40px;
    }

    p {
      display: inline;
    }

    .attribute-name,
    .cssPropertie-name,
    .propertie-name,
    .method-name,
    .event-name,
    .slot-name {
      padding: 10px 20px 10px 20px;
      margin: 10px 0 20px 0;
      background-color: #ececec;
    }

    .attribute-definition,
    .cssPropertie-definition,
    .propertie-definition,
    .method-definition,
    .event-definition,
    .slot-definition {
      margin: 0 0 20px 0;
    }

    .category-container {
      padding-bottom: 20px;
    }

    .attribute-container,
    .cssPropertie-container,
    .propertie-container,
    .method-container,
    .event-container,
    .slot-container {
      padding-bottom: 20px;
    }

    .value-table {
      margin: 0 0 30px 0;
      width: 50%;
    }

    table,
    td,
    th {
      border: 1px solid #ececec;
      border-collapse: collapse;
    }

    th {
      font-weight: bold;
    }

    td:hover {
      background-color: #ececec;
    }

    ul.links {
      margin-top: 5px;
    }

    hr.solid {
      border-top: 3px solid #f6f6f6;
    }

    .header {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 10px 20px 10px 40px;
      width: 100%;
      position: sticky;
      top: 0;
    }

    .categories {
      padding: 20px;
    }

    .category {
      padding-right: 10px;
      padding-top: 5px;
      padding-bottom: 5px;
    }

    .subcategory {
      padding-left: 10px;
    }

    .subcategory-header {
      font-weight: normal;
      margin-block-start: 0em;
      margin-block-end: 0em;
    }

    .active {
      text-decoration: underline;
    }

    .de-active {
      font-weight: normal;
      text-decoration: none;
      display: none;
    }

    .element {
      font-weight: normal;
      padding-left: 10px;
    }

    .sidebar-mv {
      color: #000;
    }

    .home {
      padding: 20px;
      overflow: auto;
      white-space: nowrap;
    }

    .sidebar-hr {
      border: 1px solid #BDBDBD;
      margin-left: 20px;
      margin-right: 20px;
      text-align: center;
    }

    .subCategory {
      padding-left: 10px;
    }

    .flipper {
      padding-left: 20px;
      padding-right: 20px;
      font-size: 1vw;
      overflow: auto;
      white-space: nowrap;
    }

    .inner-flipper {
      display: inline-block;
    }

    .inner-home {
      display: flex;
      align-items: center;
    }

    .darken {
      color: #000;
    }

    .darken:hover {
      border: 1px solid #000;
      background-color: rgba(0, 0, 0, 0.05);
    }

    .inactive-doc-example {
      display: none;
    }
  </style>
</head>

<body>
  <div class="sidebar">
    <div class="home lockup">
      <a href="../" class="sidebar-mv inner-home">
        <div class="icon-button icon-modelviewer-black inner-home"></div>
        <h1 class="inner-home">model-viewer</h1>
      </a>
    </div>
    <hr class="sidebar-hr">
    <div class="flipper">
      <div class="inner-flipper" id="examples-flipper" onclick="doClick('examples')">
        <a class="darken">EXAMPLES</a>
      </div>
      <div class="inner-flipper">|</div>
      <div class="inner-flipper" id="documentation-flipper" onclick="doClick('docs')">
        <a class="darken">DOCUMENTATION</a>
      </div>
    </div>
    <div class="categories" id="sidebar-category-container">
    </div>
  </div>

  <!-- Start of all documentation -->
  <div class="outer-content">
    <div id="loading-docs"></div>
    <div id="loading-examples"></div>
  </div>

  <script>

    var docsVisible = true;

    async function fetchHtmlAsText(url) {
      const response = await fetch(url);
      return await response.text();
    }

    async function loadExamples() {
      const loadingExample = document.getElementById("loading-examples");
      loadingExample.innerHTML = await fetchHtmlAsText("lazy-loading.html");
    }

    loadExamples();

    function doClick(newType) {
      let [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSidebarIds(previouslyActive, false);
      let example = document.getElementById(newSidebarCategory.split('-')[0].concat("-examples"));
      let doc = document.getElementById(newSidebarCategory.split('-')[0].concat("-docs"));
      if (newType === "docs") {
        doc.classList.remove('inactive-doc-example');
        example.classList.add('inactive-doc-example');
        docsVisible = true;
      } else {
        doc.classList.add('inactive-doc-example');
        example.classList.remove('inactive-doc-example');
        docsVisible = false;
      }
    }

    function makeSidebar(category) {
      let container = document.getElementById('sidebar-category-container');
      let titleLower = category.Title.toLowerCase();

      let categoryDiv = document.createElement("div");
      categoryDiv.classList.add("category");

      let categoryHeader = document.createElement("H3");
      categoryHeader.id = titleLower.concat("-sidebar");

      let categoryLink = document.createElement("a");
      categoryLink.setAttribute("href", "#".concat(titleLower))
      categoryLink.classList.add('darken');
      categoryLink.innerText = category.Title;

      categoryHeader.appendChild(categoryLink);
      categoryDiv.append(categoryHeader);

      let keyLower = "";
      for (key in category) {
        if (key !== "Title") {
          let subCategory = document.createElement("div");
          subCategory.classList.add("subCategory");

          let subCategoryLink = document.createElement("a");
          if (key === "CSS Custom Properties") {
            keyLower = "cssProperties";
          } else {
            keyLower = key.toLowerCase();
          }

          let subCategoryHeader = document.createElement("H4");
          subCategoryHeader.id = titleLower.concat("-", keyLower, "-sidebar");
          subCategoryHeader.classList.add("subcategory-header");

          subCategoryLink.setAttribute("href", "#".concat(titleLower, "-", keyLower));
          subCategoryLink.classList.add('darken');
          subCategoryLink.innerText = key;

          subCategoryHeader.appendChild(subCategoryLink);
          subCategory.append(subCategoryHeader);

          category[key].forEach(function (element) {
            let ele = document.createElement("div");
            ele.classList.add("element");
            ele.classList.add("de-active");
            ele.id = titleLower.concat("-", keyLower, "-", element.htmlName);
            let eleLink = document.createElement("a");
            eleLink.setAttribute("href", "#docs-".concat(titleLower, "-", keyLower, "-", element.htmlName));
            eleLink.classList.add('darken');
            eleLink.innerText = element.name;
            ele.appendChild(eleLink);
            subCategory.append(ele);
          });
          categoryDiv.appendChild(subCategory);
        }
      }
      container.appendChild(categoryDiv);
    }

    function loadJSON(filePath, callback) {
      let xobj = new XMLHttpRequest();
      xobj.overrideMimeType("application/json");
      xobj.open('GET', filePath, true);
      xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
          callback(xobj.responseText);
        }
      };
      xobj.send(null);
    }

    function addHeader(header) {
      let lowerHeader = header.toLowerCase();

      let para = document.createElement("div");
      para.classList.add('header');
      let node = document.createElement("H1");
      node.id = lowerHeader;
      node.innerText = header;
      para.appendChild(node);
      let element = document.getElementById(lowerHeader.concat("-docs"));
      element.appendChild(para);
    }

    function makeElement(attribute, lowerHeader, pluralCategoryLower, categoryLower) {
      let attributeContainer = document.createElement("div");
      attributeContainer.classList.add(categoryLower.concat('-container'));

      // Creating the header
      let headerContainer = document.createElement("div");
      headerContainer.classList.add(categoryLower.concat('-name'));
      headerContainer.id = ['docs', lowerHeader, pluralCategoryLower, attribute.htmlName].join('-');

      let header = document.createElement("H4");
      header.innerText = attribute.name;

      headerContainer.appendChild(header);
      attributeContainer.appendChild(headerContainer);

      // Creating the description 
      let descriptionContainer = document.createElement("div");
      descriptionContainer.classList.add(categoryLower.concat('-definition'));

      let description = document.createElement("p");
      description.innerHTML = attribute.description;

      descriptionContainer.appendChild(description);
      attributeContainer.appendChild(descriptionContainer);

      if ('default' in attribute) {
        if (categoryLower === 'attribute' || categoryLower == "cssPropertie") {
          let table = document.createElement("TABLE");
          table.classList.add("value-table");

          let tr1 = document.createElement("TR");
          let th1 = document.createElement("TH");
          th1.innerText = "Default value";
          let th2 = document.createElement("TH");
          th2.innerText = "Type";
          let th3 = document.createElement("TH");
          th3.innerText = "Options";
          tr1.appendChild(th1);
          tr1.appendChild(th2);
          tr1.appendChild(th3);
          table.appendChild(tr1);

          let tr2 = document.createElement("TR");
          let td1 = document.createElement("TD");
          td1.innerText = attribute.default[0];
          let td2 = document.createElement("TD");
          td2.innerText = attribute.default[1];
          let td3 = document.createElement("TD");
          td3.innerText = attribute.default[2];
          tr2.appendChild(td1);
          tr2.appendChild(td2);
          tr2.appendChild(td3);
          table.appendChild(tr2);

          attributeContainer.appendChild(table);
        }
      }

      // Creating the links for an attribute
      if ('links' in attribute) {
        let linksContainer = document.createElement("div");

        let header = document.createElement("H4");
        header.innerText = "Relevant Links";

        let ul = document.createElement("UL");
        ul.classList.add("links");

        attribute.links.forEach(function (link) {
          let li = document.createElement("LI");
          li.innerHTML = link;
          ul.appendChild(li);
        });
        attributeContainer.appendChild(ul);
      }

      return attributeContainer;
    }

    function addAttributes(attributeArray, header, category, categoryLower) {
      let lowerHeader = header.toLowerCase();

      let element = document.getElementById(lowerHeader.concat("-docs"));

      let outer = document.createElement("div");
      outer.classList.add(categoryLower.concat('-container'));

      let middle = document.createElement("div");
      middle.classList.add("inner-content");

      let container = document.createElement("div");
      container.id = "docs-".concat(lowerHeader, "-", categoryLower);

      let headerNode = document.createElement("H3");
      headerNode.id = lowerHeader.concat("-", categoryLower);
      headerNode.innerText = category;

      outer.appendChild(middle);
      middle.appendChild(container);
      container.appendChild(headerNode);
      element.appendChild(outer);

      attributeArray.forEach(function (attribute) {
        let attr = makeElement(attribute, lowerHeader, categoryLower, categoryLower.slice(0, -1));
        container.appendChild(attr);
      });
    }

    function convertJSONToHTML(json) {
      let obj = json;
      let header = '';
      let keyLower = '';
      obj.forEach(function (category) {
        // Make body content
        for (let key in category) {
          if (key === 'Title') {
            header = category[key];
            addHeader(category[key]);
          } else if (key !== "Title") {
            if (key === "CSS Custom Properties") {
              keyLower = "cssProperties";
            } else {
              keyLower = key.toLowerCase();
            }
            addAttributes(category[key], header, key, keyLower);
          }
        }
        makeSidebar(category);
      });
    }

    
    function updateSidebarActive(sidebarName, sidebarSubcategory, sidebarCategory, isActive) {
      if (isActive) {
        document.querySelector(`div[id=${sidebarName}]`).classList.add('active');
        document.querySelector(`h4[id=${sidebarSubcategory}]`).classList.add('active');
        document.querySelector(`h3[id=${sidebarCategory}]`).classList.add('active');
      } else {
        document.querySelector(`div[id=${sidebarName}]`).classList.remove('active');
        document.querySelector(`h4[id=${sidebarSubcategory}]`).classList.remove('active');
        document.querySelector(`h3[id=${sidebarCategory}]`).classList.remove('active');
      }
    };

    function addDeactive(sidebarName) {
      document.querySelector(`div[id=${sidebarName}]`).classList.add('de-active');
    }

    function removeDeactive(sidebarName) {
      document.querySelector(`div[id=${sidebarName}]`).classList.remove('de-active');
    }

    /*
     * name: string of either the id of the attribute in the main view or the sidebarName
     * isId: boolean to determine whether the name is the id or sidebarName
    */
    function getSidebarIds(name, isId) {
      const sb = "sidebar";
      let [sidebarName, sidebarSub, sidebarCat] = ["", "", ""];
      if (isId) {
        sidebarName = name.split("-").slice(1, 10).join('-');
        sidebarSub = name.split("-").slice(1, 3);
        sidebarCat = name.split("-").slice(1, 2);
      } else {
        sidebarName = name;
        sidebarSub = sidebarName.split("-").slice(0, 2);
        sidebarCat = sidebarName.split("-").slice(0, 1);
      }
      sidebarSub.push(sb);
      const sidebarSubcategory = sidebarSub.join('-');
      sidebarCat.push(sb);
      const sidebarCategory = sidebarCat.join('-');
      return [sidebarName, sidebarSubcategory, sidebarCategory];
    }

    var globalCurrentView = [];
    var previouslyActive = '';
    var toRemove = '';
    var globalOrdering = [];

    var isFirstOpen = true;  // is true on the first observation of all entries
    var everyEntry = [];     // a list of all attributes/properties etc.

    /* 
     * Update the sidebar 
     * sidebarSubcategory: string of the old subcategory being replaced
     * newSidebarSubcategory: string of the new subcategory
     * example: 
     *  sidebarSubcategory = loading-attributes
     *  newSidebarSubcategory = loading-cssProperties
    */
    function updateSidebarView(sidebarSubcategory, newSidebarSubcategory) {
      if (sidebarSubcategory !== newSidebarSubcategory) {
        everyEntry.forEach(entry => {
          const id = entry.target.getAttribute('id');
          const [currentSidebarName, currentSidebarSubcategory, currentSidebarCategory] = getSidebarIds(id, true);
          if (currentSidebarSubcategory !== newSidebarSubcategory) {
            addDeactive(currentSidebarName);
          } else {
            removeDeactive(currentSidebarName);
          }
        });
      }
    }

    /*
     * Hide all of the entries not within the current subcategory, default: Loading->Attributes
    */
    function updateSidebarViewFirstTime(entries) {
      isFirstOpen = false;  // global
      everyEntry = entries; // Sets global variable for use in updateSidebarView
      const [sidebarName, sidebarSubcategory, sidebarCategory] = getSidebarIds(previouslyActive, false);
      updateSidebarView("", sidebarSubcategory);
    }

    /* 
     * Update the table of contents based on how the page is viewed. 
    */
    function sidebarObserver() {
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          const id = entry.target.getAttribute('id');
          const [sidebarName, sidebarSubcategory, sidebarCategory] = getSidebarIds(id, true);

          if (entry.intersectionRatio > 0) {
            // If you are within a long section so the header left view
            if (toRemove.length > 0) {
              let [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSidebarIds(previouslyActive, false);
              updateSidebarActive(newSidebarName, newSidebarSubcategory, newSidebarCategory, false);
              updateSidebarActive(sidebarName, sidebarSubcategory, sidebarCategory, true);
              updateSidebarView(previouslyActive, newSidebarSubcategory, sidebarName, sidebarSubcategory);
              toRemove = '';
            }
            // If there isn't anything in globalCurrentView
            else if (globalCurrentView.length === 0) {
              updateSidebarActive(sidebarName, sidebarSubcategory, sidebarCategory, true);
              previouslyActive = sidebarName;
              globalCurrentView.push(sidebarName);

              // sidebarName index lesser means it appears above the currently active view
            } else if (globalOrdering.indexOf(previouslyActive) > globalOrdering.indexOf(sidebarName)) {
              let newSidebarName = globalCurrentView[0];
              [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSidebarIds(newSidebarName, false);

              updateSidebarActive(newSidebarName, newSidebarSubcategory, newSidebarCategory, false);
              updateSidebarActive(sidebarName, sidebarSubcategory, sidebarCategory, true);
              updateSidebarView(newSidebarSubcategory, sidebarSubcategory);

              globalCurrentView.unshift(sidebarName);
              previouslyActive = sidebarName;

            } else {
              globalCurrentView.push(sidebarName);
            }
            // the intersection was updated and its now out of view, but still within a property
          } else if (globalCurrentView.length === 1) {
            toRemove = previouslyActive;
            // the intersection was updated and its now out of view
          } else {
            // if the thing being removed from view was currently active
            if (previouslyActive === sidebarName) {
              updateSidebarActive(sidebarName, sidebarSubcategory, sidebarCategory, false);
              if (globalCurrentView.length >= 2) {
                newSidebarName = globalCurrentView[1];
                [newSidebarName, newSidebarSubcategory, newSidebarCategory] = getSidebarIds(newSidebarName, false);
                updateSidebarActive(newSidebarName, newSidebarSubcategory, newSidebarCategory, true);
                updateSidebarView(sidebarSubcategory, newSidebarSubcategory);
                previouslyActive = newSidebarName;
              }
            }
            globalCurrentView = globalCurrentView.filter(e => e !== sidebarName);
          }
        });

        // This is true the first time all of the observers are set.
        // entries will be every possible entry on the whole page.
        if (isFirstOpen) {
          updateSidebarViewFirstTime(entries);
        }
      });

      // Fill the observer with the necessary divs to observe: attributes, properties, etc.
      document.querySelectorAll('div[id*="docs"]').forEach((section) => {
        let idSplitList = section.getAttribute('id').split('-');
        if (idSplitList.length === 4) {
          globalOrdering.push(idSplitList.slice(1, 10).join('-'));
          observer.observe(section);
        }
      });
    };

    // Load the JSON asynchronously, then generate the sidebarObserver after all the documentation in the window.
    function init() {
      loadJSON('./data/loading.json', function (response) {
        let actualJSON = JSON.parse(response);
        convertJSONToHTML(actualJSON);
        sidebarObserver();
      });
    }

    init();

    window.onscroll = function () { stickyHeader() };

    function stickyHeader() {
      let headers = document.getElementsByClassName("header");
      for (let i = 0; i < headers.length; i++) {
        let header = headers[i];
        let sticky = header.offsetTop;
        if (window.pageYOffset > sticky) {
          header.classList.add("sticky");
        } else {
          header.classList.remove("sticky");
        }
      }
    }

  </script>

  <!-- Documentation-specific dependencies: -->
  <script type="module" src="./built/dependencies.js">
  </script>
  <script nomodule src="./built/dependencies-legacy.js">
  </script>

  <!-- Loads <model-viewer> only on modern browsers: -->
  <script type="module" src="../node_modules/@google/model-viewer/dist/model-viewer.js">
  </script>

  <!-- Loads <model-viewer> only on old browsers like IE11: -->
  <script nomodule src="../node_modules/@google/model-viewer/dist/model-viewer-legacy.js">
  </script>
</body>

</html>